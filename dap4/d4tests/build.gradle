apply from: "$rootDir/gradle/any/dependencies.gradle"
apply from: "$rootDir/gradle/any/java-test-only.gradle"

dependencies {
  implementation enforcedPlatform(project(':tds-platform'))
  implementation enforcedPlatform(project(':tds-testing-platform'))

  // A lot of these dependencies should be in the testRuntime config, not testCompile.
  testImplementation 'edu.ucar:d4core'
  testImplementation 'edu.ucar:d4lib'
  testImplementation 'edu.ucar:d4cdm'
  testImplementation project(':dap4:dap4-servlet')

  testImplementation(project(':dap4:d4ts')) {
    exclude group: 'org.apache.logging.log4j'
  }

  testImplementation 'edu.ucar:d4lib'
  testImplementation 'edu.ucar:d4cdm'
  testImplementation 'edu.ucar:cdm-core'
  testImplementation 'edu.ucar:httpservices'

  testCompile(project(':tds')) {
    // depending on TDS does not seem right. Need to break out the parts that are important
    // to other services and make that a separate subproject.
    exclude group: 'org.apache.logging.log4j'
    exclude group: 'org.apache.taglibs', module: 'taglibs-standard-spec'
    exclude group: 'org.apache.taglibs', module: 'taglibs-standard-impl'
    exclude group: 'EDS', module: 'tds-plugin'
    exclude group: 'net.sf.saxon', module: 'Saxon-HE'
  }

  testImplementation 'javax.servlet:javax.servlet-api'
  testImplementation 'org.slf4j:slf4j-api'

  implementation 'org.slf4j:slf4j-api'
  runtime 'org.apache.logging.log4j:log4j-slf4j-impl'
  testImplementation 'org.apache.logging.log4j:log4j-web'
  testRuntime 'ch.qos.logback:logback-classic'

  // Spring
  implementation 'org.springframework:spring-test'
  implementation 'org.springframework:spring-core'
  implementation 'org.springframework:spring-context'
  implementation 'org.springframework:spring-beans'
  implementation 'org.springframework:spring-web'
  implementation 'org.springframework:spring-webmvc'

  testImplementation 'junit:junit'
  testImplementation project(':tds-test-utils')
  testImplementation 'edu.ucar:cdm-test-utils'
}

test {
  systemProperties['testargs'] = System.getProperty('testargs', '')

  include 'dap4/test/TestCDMClient.class'
  include 'dap4/test/TestConstraints.class'
  include 'dap4/test/TestDSP.class'
  include 'dap4/test/TestDSR.class'
  include 'dap4/test/TestNc4Iosp.class'
  include 'dap4/test/TestParserCE.class'
  include 'dap4/test/TestParserDMR.class'
  include 'dap4/test/TestServlet.class'
  include 'dap4/test/TestServletConstraints.class'
  include 'dap4/test/TestFrontPage.class'
  //include 'dap4/test/TestFilters.class'
  //include 'dap4/test/TestH5Iosp.class'
  //include 'dap4/test/TestHyrax.class'
  //include 'dap4/test/TestPrinter.class'
  //include 'dap4/test/TestSerial.class'
}

test.dependsOn(':dap4:d4ts:AppWarBeforeIntegrationTest')
test.finalizedBy(':dap4:d4ts:AppWarAfterIntegrationTest')
